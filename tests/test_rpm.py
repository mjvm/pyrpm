# -*- coding: utf-8 -*-
# -*- Mode: Python; py-ident-offset: 4 -*-
# vim:ts=4:sw=4:et
'''
High level pyrpm tests

'''

import unittest
from io import BytesIO

from pyrpm import RPM, rpmdefs

rpm_file = b'\xed\xab\xee\xdb\x03\x00\x00\x00\x00\x01Eterm-0.9.3-5mdv2007.0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x8e\xad\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\xd8\x00\x00\x00>\x00\x00\x00\x07\x00\x00\x00\xc8\x00\x00\x00\x10\x00\x00\x01\x0b\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00A\x00\x00\x01\r\x00\x00\x00\x06\x00\x00\x00A\x00\x00\x00\x01\x00\x00\x03\xe8\x00\x00\x00\x04\x00\x00\x00l\x00\x00\x00\x01\x00\x00\x03\xec\x00\x00\x00\x07\x00\x00\x00p\x00\x00\x00\x10\x00\x00\x03\xed\x00\x00\x00\x07\x00\x00\x00\x80\x00\x00\x00A\x00\x00\x03\xef\x00\x00\x00\x04\x00\x00\x00\xc4\x00\x00\x00\x01\x88?\x03\x05\x00H\xe5N\x17DY5\xf8x\xd0\x19\xf5\x11\x02\xaf \x00\x9ff\xa4\x01cN\x8d\xcc\xcf\xb3\x96`\x92\x83*\xeb\xb9\x94r\x93\xfa\x00\x9e9\xf0r\x92\x95#\xf6\x9e\xcaE\x8eU\xfb\xea\xdc\x0f\xca\xed\xb7\xc92e3cc15e7c0f1a7da51480711bb4d893ab28b7a0\x00\x00\x00\x00\x1fh\xbd\x0b~\x13\xed<~\xe4\xb9ht9\xe8\r\x86\xb2-\x88?\x03\x05\x00H\xe5N\x17DY5\xf8x\xd0\x19\xf5\x11\x02\xc7e\x00\xa0\x80\x8c\x17o\x8a\xc7x\xed#ayBq\xcf\xa8\xab\xfcv\x1d\xad\x00\x9a\x02\xe5\xc3\xf9l\xa48\xfb\xb7\xad\xf2d\x85n\x8fR*Ey\x01\x00\x00\x00\x00$\xcf\xc8\x00\x00\x00>\x00\x00\x00\x07\xff\xff\xff\x90\x00\x00\x00\x10\x8e\xad\xe8\x01\x00\x00\x00\x00\x00\x00\x00?\x00\x00Fl\x00\x00\x00?\x00\x00\x00\x07\x00\x00F\\\x00\x00\x00\x10\x00\x00\x00d\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x03\xe8\x00\x00\x00\x06\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x03\xe9\x00\x00\x00\x06\x00\x00\x00\x08\x00\x00\x00\x01\x00\x00\x03\xea\x00\x00\x00\x06\x00\x00\x00\x0e\x00\x00\x00\x01\x00\x00\x03\xec\x00\x00\x00\t\x00\x00\x00\x19\x00\x00\x00\x01\x00\x00\x03\xed\x00\x00\x00\t\x00\x00\x00V\x00\x00\x00\x01\x00\x00\x03\xee\x00\x00\x00\x04\x00\x00\x02D\x00\x00\x00\x01\x00\x00\x03\xef\x00\x00\x00\x06\x00\x00\x02H\x00\x00\x00\x01\x00\x00\x03\xf1\x00\x00\x00\x04\x00\x00\x02X\x00\x00\x00\x01\x00\x00\x03\xf2\x00\x00\x00\x06\x00\x00\x02\\\x00\x00\x00\x01\x00\x00\x03\xf3\x00\x00\x00\x06\x00\x00\x02k\x00\x00\x00\x01\x00\x00\x03\xf6\x00\x00\x00\x06\x00\x00\x02t\x00\x00\x00\x01\x00\x00\x03\xf7\x00\x00\x00\x06\x00\x00\x02x\x00\x00\x00\x01\x00\x00\x03\xf8\x00\x00\x00\t\x00\x00\x02\x9b\x00\x00\x00\x01\x00\x00\x03\xfc\x00\x00\x00\x06\x00\x00\x02\xa5\x00\x00\x00\x01\x00\x00\x03\xfd\x00\x00\x00\x06\x00\x00\x02\xc3\x00\x00\x00\x01\x00\x00\x03\xfe\x00\x00\x00\x06\x00\x00\x02\xc9\x00\x00\x00\x01\x00\x00\x04\x00\x00\x00\x00\x06\x00\x00\x02\xce\x00\x00\x00\x01\x00\x00\x04\x02\x00\x00\x00\x06\x00\x00\x04\x04\x00\x00\x00\x01\x00\x00\x04\x04\x00\x00\x00\x04\x00\x00\x04\xa0\x00\x00\x00z\x00\x00\x04\x06\x00\x00\x00\x03\x00\x00\x06\x88\x00\x00\x00z\x00\x00\x04\t\x00\x00\x00\x03\x00\x00\x07|\x00\x00\x00z\x00\x00\x04\n\x00\x00\x00\x04\x00\x00\x08p\x00\x00\x00z\x00\x00\x04\x0b\x00\x00\x00\x08\x00\x00\nX\x00\x00\x00z\x00\x00\x04\x0c\x00\x00\x00\x08\x00\x00\x17\xd2\x00\x00\x00z\x00\x00\x04\r\x00\x00\x00\x04\x00\x00\x18\xd0\x00\x00\x00z\x00\x00\x04\x0f\x00\x00\x00\x08\x00\x00\x1a\xb8\x00\x00\x00z\x00\x00\x04\x10\x00\x00\x00\x08\x00\x00\x1d\x1a\x00\x00\x00z\x00\x00\x04\x14\x00\x00\x00\x06\x00\x00\x1f|\x00\x00\x00\x01\x00\x00\x04\x15\x00\x00\x00\x04\x00\x00\x1f\x9c\x00\x00\x00z\x00\x00\x04\x17\x00\x00\x00\x08\x00\x00!\x84\x00\x00\x00\x01\x00\x00\x04\x18\x00\x00\x00\x04\x00\x00!\x8c\x00\x00\x00\x1d\x00\x00\x04\x19\x00\x00\x00\x08\x00\x00"\x00\x00\x00\x00\x1d\x00\x00\x04\x1a\x00\x00\x00\x08\x00\x00#\x8b\x00\x00\x00\x1d\x00\x00\x04(\x00\x00\x00\x06\x00\x00#\xb4\x00\x00\x00\x01\x00\x00\x048\x00\x00\x00\x04\x00\x00#\xbc\x00\x00\x00\x08\x00\x00\x049\x00\x00\x00\x08\x00\x00#\xdc\x00\x00\x00\x08\x00\x00\x04:\x00\x00\x00\x08\x00\x00%o\x00\x00\x00\x08\x00\x00\x04>\x00\x00\x00\x06\x00\x00(\n\x00\x00\x00\x01\x00\x00\x04@\x00\x00\x00\x06\x00\x00(\x12\x00\x00\x00\x01\x00\x00\x04F\x00\x00\x00\x06\x00\x00(\x1a\x00\x00\x00\x01\x00\x00\x04G\x00\x00\x00\x04\x00\x00(8\x00\x00\x00z\x00\x00\x04H\x00\x00\x00\x04\x00\x00* \x00\x00\x00z\x00\x00\x04I\x00\x00\x00\x08\x00\x00,\x08\x00\x00\x00z\x00\x00\x04X\x00\x00\x00\x04\x00\x00,\x84\x00\x00\x00\x01\x00\x00\x04Y\x00\x00\x00\x08\x00\x00,\x88\x00\x00\x00\x01\x00\x00\x04\\\x00\x00\x00\x04\x00\x00,\x9c\x00\x00\x00z\x00\x00\x04]\x00\x00\x00\x08\x00\x00.\x84\x00\x00\x00z\x00\x00\x04^\x00\x00\x00\x08\x00\x005\x00\x00\x00\x00\x12\x00\x00\x04b\x00\x00\x00\x06\x00\x006\xaf\x00\x00\x00\x01\x00\x00\x04d\x00\x00\x00\x06\x00\x0071\x00\x00\x00\x01\x00\x00\x04e\x00\x00\x00\x06\x00\x0076\x00\x00\x00\x01\x00\x00\x04f\x00\x00\x00\x06\x00\x007;\x00\x00\x00\x01\x00\x00\x04k\x00\x00\x00\x06\x00\x007=\x00\x00\x00\x01\x00\x00\x04l\x00\x00\x00\x06\x00\x007B\x00\x00\x00\x01\x00\x00\x04t\x00\x00\x00\x04\x00\x007\\\x00\x00\x00z\x00\x00\x04u\x00\x00\x00\x04\x00\x009D\x00\x00\x00z\x00\x00\x04v\x00\x00\x00\x08\x00\x00;,\x00\x00\x00\x1b\x00\x00\x04w\x00\x00\x00\x04\x00\x00@\x94\x00\x00\x00z\x00\x00\x04x\x00\x00\x00\x04\x00\x00B|\x00\x00\x00z\x00\x00\x04z\x00\x00\x00\x07\x00\x00Dd\x00\x00\x00\x10\x00\x00\x04\x99\x00\x00\x00\x04\x00\x00Dt\x00\x00\x00zC\x00Eterm\x000.9.3\x005mdv2007.0\x00Eterm (Enlightened Terminal Emulator) is a terminal emulator\x00Eterm is a color vt102 terminal emulator intended as a replacement for Xterm.\nIt is designed with a Freedom of Choice philosophy, leaving as much power,\nflexibility, and freedom as possible in the hands of the user.\n\nIt is designed to look good and work well, but takes a feature-rich approach\nrather than one of minimalism while still maintaining speed and efficiency.\n\nIt works on any windowmanager/desktop environment, although it is designed\nto work and integrate best with Enlightenment.\x00\x00D\xfe\xcf\xb8n5.mandriva.com\x00\x00$\x86tMandriva Linux\x00Mandriva\x00BSD\x00Jerome Soyer <saispo@mandriva.org>\x00Terminals\x00http://eterm.sourceforge.net/\x00linux\x00i586\x00if [ -x /usr/bin/update-menus ]; then /usr/bin/update-menus || true ; fi \n\nupdate-alternatives --install /usr/bin/xvt xvt /usr/bin/Eterm 15\n\nif [ -d /usr/share/terminfo -a ! -f /usr/share/terminfo/E/Eterm ]; then\n    tic -o /usr/share/terminfo /usr/share/doc/Eterm-0.9.3/Eterm.ti\nfi\n\n/usr/bin/Etbg_update_list\x00if [ "$1" = "0" -a -x /usr/bin/update-menus ]; then /usr/bin/update-menus || true ; fi \n\t\n[ "$1" = "0" ]&& update-alternatives --remove xvt /usr/bin/Eterm\x00\x00\x00\x00-\xdc\x00\x00\x0f\xd8\x00\x00\ni\x00\x00\x07u\x00\x00\r|\x00\x00\x02\xc9\x00\x00\x11\xc8\x00\x00\rN\x00\x00\x00\xb8\x00\x00\x10\x00\x00\x00\x10\x00\x00\x00\x02\xd3\x00\x00\x02\xf6\x00\x00\x02\xcc\x00\x00\x032\x00\x00\x03-\x00\x00\x03,\x00\x00\x02\xeb\x00\x00\x02\xd3\x00\x00\x02\xd4\x00\x00\x02\xc5\x00\x00\x02\xb9\x00\x00\x02\xc0\x00\x00\x16\xd5\x00\x00\x0cu\x00\x00\x042\x00\x00\x04J\x00\x00\x04W\x00\x00\x06\x91\x00\x00\x10\x00\x00\x00R\x01\x00\x00~O\x00\x00\x01\xba\x00\x00\x02\x18\x00\x00nm\x00\x00)z\x00\x00\x00\xd2\x00\x00\x00\xd2\x00\x00\x10\x00\x00\x00\xd5U\x00\x00\x04\xf2\x00\x02\x11\x88\x00\x00\xb8/\x00\x00H\xc6\x00\x00H\xe6\x00\x00-N\x00\x006V\x00\x002\x1e\x00\x00\xc5\xa0\x00\x00\x88\x9b\x00\x00"_\x00\x00\x07\x86\x00\x00\n\x95\x00\x00\x01\x04\x00\x00.\xe0\x00\x00q\xb3\x00\x00G\xd7\x00\x00\x80)\x00\x011\xde\x00\x00@\xd1\x00\x00\xdf`\x00\x00\xa2\x87\x00\x009O\x00\x00)\'\x00\x00\xf0\x1c\x00\x00\xdd%\x00\x00{R\x00\x00:6\x00\x00\xe7f\x00\x00X\xbc\x00\x00\xb7\xe1\x00\x00\x0c\x9f\x00\x01\x00k\x00\x01\x9f<\x00\x01\xda\x00\x00\x00\xa3\xd6\x00\x00\xbc\xa4\x00\x00\xc3U\x00\x00]O\x00\x01Ku\x00\x00\xb0\x8c\x00\x00&\x1b\x00\x00-\xbb\x00\x00R\xc3\x00\x01"\x92\x00\x00"\x95\x00\x00\xd8\x04\x00\x00\x10\x00\x00\x00\x10\x00\x00\x00\x006\x00\x00\x00\x16\x00\x00\x0e\xde\x00\x00\x10\x00\x00\x00F\xd5\x00\x00\x00\x16\x00\x00-#\x00\x00\x10\x00\x00\x00F\xd5\x00\x00\x00\x16\x00\x00\x110\x00\x00\x10\x00\x00\x006\xb5\x00\x00\x00\x16\x00\x00.g\x00\x00\x10\x00\x00\x00>~'


class RPMTest(unittest.TestCase):

    def setUp(self):
        # with io.open('tests/Eterm-0.9.3-5mdv2007.0.rpm', 'rb') as f:
        #     self.rpm = RPM(f)
        self.rpm = RPM(BytesIO(rpm_file))

    def test_entries(self):

        description = '''Eterm is a color vt102 terminal emulator intended as a replacement for Xterm.\nIt is designed with a Freedom of Choice philosophy, leaving as much power,\nflexibility, and freedom as possible in the hands of the user.\n\nIt is designed to look good and work well, but takes a feature-rich approach\nrather than one of minimalism while still maintaining speed and efficiency.\n\nIt works on any windowmanager/desktop environment, although it is designed\nto work and integrate best with Enlightenment.'''

        self.assertEqual(self.rpm[rpmdefs.RPMTAG_NAME], 'Eterm')
        self.assertEqual(self.rpm[rpmdefs.RPMTAG_VERSION], '0.9.3')
        self.assertEqual(self.rpm[rpmdefs.RPMTAG_RELEASE], '5mdv2007.0')
        self.assertEqual(self.rpm[rpmdefs.RPMTAG_ARCH], 'i586')
        self.assertEqual(self.rpm[rpmdefs.RPMTAG_COPYRIGHT], 'BSD')
        self.assertEqual(self.rpm[rpmdefs.RPMTAG_DESCRIPTION], description)

    def test_package_type(self):
        self.assertEqual(self.rpm.binary, True)
        self.assertEqual(self.rpm.source, False)

    def test_name(self):
        self.assertEqual(self.rpm.name(), 'Eterm')

    def test_package(self):
        self.assertEqual(self.rpm.package(), 'Eterm-0.9.3')

    def test_filename(self):
        self.assertEqual(self.rpm.filename(), 'Eterm-0.9.3-5mdv2007.0.i586.rpm')
